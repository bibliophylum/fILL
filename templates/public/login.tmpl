<TMPL_INCLUDE NAME="header.tmpl">

<script type="text/javascript">
  
$('document').ready(function(){

    $("#search").hide();
    $(".inline-items").children().hide();
    $(".inline-items").children(":contains('home')").show();
    $("#fill-button").hide();  // hide the logout button, as it makes no sense here

    var homeLibraryLID = $.cookie("fILL-lid");
    var homeLibraryLocation = $.cookie("fILL-location");
    var patronBarcode = $.cookie("fILL-barcode");
    if (homeLibraryLocation) {
        $("#home-library-location").text( homeLibraryLocation );
        $("#home-library").show();
    }
    if ($.cookie("fILL-authentication")) {
        if ($.cookie("fILL-authentication") === "sip2") {
            $("#sip2").show();
            $("#non-sip2").hide()
            $("#authen_barcode").val( patronBarcode );
            $("#authen_lid").val( homeLibraryLID );
            $("#authen_loginfield").val( "using-sip2" );
            $("#authen_passwordfield").val( "using-sip2" );
            $("#authen_pin").focus();
        } else {
            $("#authen_barcode").val( "not-using-sip2" );
            $("#authen_pin").val( "not-using-sip2" );
            $("#authen_lid").val( homeLibraryLID ); // undef?
            $("#authen_loginfield").focus();
        }
    } else {
        $("#authentication-method").show();
        $("#sip2").hide();
        $("#non-sip2").hide();
        $("#sign-in").hide();
    }

    $("#loginform").on('submit', function(e){
        e.preventDefault();

        var myAlert = "";
        $("#loginform :input").each(function(i){
          var $input = $(this);
          myAlert += $input.attr('name')+':'+$input.val()+'\n';
        });
//        alert(myAlert);

        if (! $.cookie("fILL-authentication")) {
            // these cookies don't exist, so create them.
            if ($("#authen_barcode").val()) {
                $.cookie("fILL-barcode", $("#authen_barcode").val(), { expires: 365, path: '/' });
                $.cookie("fILL-authentication", "sip2", { expires: 365, path: '/' });
                $("#authen_loginfield").val( "using-sip2" );
                $("#authen_passwordfield").val( "using-sip2" );
            } else {
                $.cookie("fILL-authentication", "fILL", { expires: 365, path: '/' });
                $("#authen_barcode").val( "not-using-sip2" );
                $("#authen_pin").val( "not-using-sip2" );
            }
        }

        this.submit();
    });

    $("#auth-sip2").on("click",function(){
        $("#sip2").show();
        $("#non-sip2").hide();
        $("#sign-in").show();
    });

    $("#auth-fILL").on("click",function(){
        $("#sip2").hide();
        $("#non-sip2").show();
        $("#sign-in").show();
    });

});

</script>
<div id="clear"></div>

<div class="login">

  <form action="/cgi-bin/public.cgi" method="post" name="loginform" id="loginform">
    <fieldset name="login">

      <legend>Patron Login</legend>

      <div id="authentication-method" style="display:none">
	<p>How do you log in to fILL?</p>
	<input id="auth-sip2" class="public-style" type="button" value="My library  " /> Use my library card and PIN<br/>
	<input id="auth-fILL" class="public-style" type="button" value="fILL account" /> Use my fILL username and password<br/>
      </div>

      <div id="home-library" style="display:none">
	<table>
	  <tr>
	    <td>Home library location:</td>
	    <td><p id="home-library-location"></p></td>
	</tr>
	</table>
      </div>

      <div id="sip2" style="display:none">
	<p>Log in using your library barcode and PIN</p>
	<fieldset name="login">
	  <label for="authen_barcode">Library card number</label>
	  <input type="text" value="" size="15" name="authen_barcode" tabindex="1" id="authen_barcode"><br>
          <label for="authen_pin">PIN number</label>
          <input type="password" size="15" name="authen_pin" tabindex="2" id="authen_pin"><br>
        </fieldset>
      </div> <!-- div id sip2 -->

      <div id="non-sip2">
	<p>Log in using your fILL username and password</p>
        <label for="authen_username">User Name</label>
        <input type="text" value="" autocapitalize="off" name="authen_username" tabindex="1" id="authen_loginfield" /><br>
        <label for="authen_password">Password</label>
        <input type="password" name="authen_password" tabindex="2" id="authen_passwordfield" /><br>
      </div> <!-- div id non-sip2 -->

    </fieldset>

    <div id="sign-in">
      <fieldset>
	<input type="submit" class="button-left public-style" value="Sign In" name="authen_loginbutton" tabindex="4" id="authen_loginbutton">
	<input type="checkbox" value="1" name="authen_rememberuser" tabindex="3" id="authen_rememberuserfield"><span>Remember User Name</span><br>
      </fieldset>
    </div>
      

    <div class="login-footer">
      <p>Don&rsquo;t have an account?</p>
      <a href="?rm=registration_form" type="button" role="button" id="fill-button" class="public-style">Sign Up!</a>
      <p>If you cannot remember your user name or password, please contact your local public library.</p>
    </div> <!--div class login-footer -->

    <input type="hidden" value="https://localhost/cgi-bin/public.cgi?rm=search_form;submit=Log%20in" name="destination">
    <input type="hidden" name="authen_lid" id="authen_lid" value="">
    <input type="hidden" value="authen_login" name="rm">
  </form>

</div> <!-- div class login -->

<script language="JavaScript" type="text/javascript">
  $('#csstabs').hide();
</script>

<script language="JavaScript" type="text/javascript">
  document.loginform.authen_username.focus();
</script>

<TMPL_INCLUDE NAME="footer.tmpl">
