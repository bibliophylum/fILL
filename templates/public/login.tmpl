<TMPL_INCLUDE NAME="header.tmpl">
<script type="text/javascript" src="/js/login-lost-lid.js"></script>

<script type="text/javascript">
  
$('document').ready(function(){

    $("#search").hide();
    $(".inline-items").children().hide();
    $(".inline-items").append('<li><a id="menu_login" class="current_tab" href="/cgi-bin/public.cgi">Welcome</a></li>');
    $(".inline-items").append('<li><a id="menu_new" href="/new.html">New to fILL?</a></li>');
    $("#menu_login").show();
    $("#menu_new").show();

    $("#fill-button").hide();  // hide the logout button, as it makes no sense here

    var homeLibraryLID = $.cookie("fILL-lid");
    var homeLibraryLocation = $.cookie("fILL-location");
    var patronBarcode = $.cookie("fILL-barcode");
    if (homeLibraryLocation) {
        $("#home-library-location").text( homeLibraryLocation );
        $("#home-library").show();
    }
    if (! $.cookie("fILL-lid")) {
        $.getJSON('/cgi-bin/get-map-regions.cgi', 
            function(data){
              choose_library(data);
        });
    } else {
        if ($.cookie("fILL-authentication") === "sip2") {
            $("#sip2").show();
            $("#non-sip2").hide();
            $("#authen_barcode").val( $.cookie("fILL-barcode") );
            $("#authen_loginfield").val( "using-sip2" );
            $("#authen_passwordfield").val( "using-sip2" );
            $("#authen_pin").focus();
	} else {
            $("#sip2").hide();
            $("#non-sip2").show();
            $("#authen_barcode").val( "not-using-sip2" );
            $("#authen_pin").val( "not-using-sip2" );
            $("#authen_loginfield").focus();
	}
        $("#authen_lid").val( $.cookie("fILL-lid") );
        $("#sign-in").show();
    }

    $("#loginform").on('submit', function(e){
        e.preventDefault();

        var myAlert = "";
        $("#loginform :input").each(function(i){
          var $input = $(this);
          myAlert += $input.attr('name')+':'+$input.val()+'\n';
        });
        //alert(myAlert);

        if (! $.cookie("fILL-authentication")) {
            // these cookies don't exist, so create them.
            if ($("#authen_barcode").val()) {
                $.cookie("fILL-barcode", $("#authen_barcode").val(), { expires: 365, path: '/' });
                $.cookie("fILL-authentication", "sip2", { expires: 365, path: '/' });
                $("#authen_loginfield").val( "using-sip2" );
                $("#authen_passwordfield").val( "using-sip2" );
            } else {
                $.cookie("fILL-authentication", "fILL", { expires: 365, path: '/' });
                $("#authen_barcode").val( "not-using-sip2" );
                $("#authen_pin").val( "not-using-sip2" );
            }
        }

        this.submit();
    });

//    $("#auth-sip2").on("click",function(){
//        $("#sip2").show();
//        $("#non-sip2").hide();
//        $("#sign-in").show();
//    });
//
//    $("#auth-fILL").on("click",function(){
//        $("#sip2").hide();
//        $("#non-sip2").show();
//        $("#sign-in").show();
//    });

    $("#nav2").append(' | </span><a href="/cgi-bin/admin.cgi">Admin</a><span style="color:#aabdba;">');
    $("#nav2").append(' | </span><a href="/cgi-bin/lightning.cgi">Library Staff</a>');

});

</script>
<div id="clear"></div>

<div id="aside-img-welcome" class="tone-box">
    <img src='/img/fill-search.jpg' alt="open book"/><br />
    <p class="note">Image care of <a href="http://pixabay.com/en/book-open-pages-library-books-92771/">kshelton</a>

    <p id="welcome-text">Welcome to the Manitoba public libraries' interlibrary loan system.</p>
</div>

<div id="main-info-welcome">

  <div class="login">

  <form action="/cgi-bin/public.cgi" method="post" name="loginform" id="loginform">
    <fieldset name="login">

      <legend>Login</legend>

      <div id="region"></div>
      <div id="libraries"></div>

<!--
      <div id="authentication-method" style="display:none">
	<p>How do you log in to fILL?</p>
	<input id="auth-sip2" class="public-style" type="button" value="My library  " /> Use my library card and PIN<br/>
	<input id="auth-fILL" class="public-style" type="button" value="fILL account" /> Use my fILL username and password<br/>
      </div>
-->

      <div id="home-library" style="display:none">
	<table>
	  <tr>
	    <td>Home library location:</td>
	    <td><p id="home-library-location"></p></td>
	</tr>
	</table>
      </div>

      <div id="sip2" style="display:none">
	<p>Log in using your library barcode and PIN</p>
        <div id="chooseLibrary" style="display:none">
	  <div id="region">
	  </div>
        </div>

	<fieldset name="login">
	  <label for="authen_barcode">Library card number</label>
	  <input type="text" value="" size="15" name="authen_barcode" tabindex="1" id="authen_barcode"><br>
          <label for="authen_pin">PIN number</label>
          <input type="password" size="15" name="authen_pin" tabindex="2" id="authen_pin"><br>
        </fieldset>
      </div> <!-- div id sip2 -->

      <div id="non-sip2" style="display:none">
	<p>Log in using your fILL username and password</p>
        <label for="authen_username">User Name</label>
        <input type="text" value="" autocapitalize="off" name="authen_username" tabindex="1" id="authen_loginfield" /><br>
        <label for="authen_password">Password</label>
        <input type="password" name="authen_password" tabindex="2" id="authen_passwordfield" /><br>
      </div> <!-- div id non-sip2 -->

    </fieldset>

    <div id="sign-in" style="display:none">
      <fieldset>
	<input type="submit" class="button-left public-style" value="Sign In" name="authen_loginbutton" tabindex="4" id="authen_loginbutton">
	<input type="checkbox" value="1" name="authen_rememberuser" tabindex="3" id="authen_rememberuserfield"><span>Remember User Name</span><br>
      </fieldset>
    </div>
      

    <div class="login-footer">
      <p><strong>Don&rsquo;t have an account?</strong></p>
      <a href="?rm=registration_form" type="button" role="button" id="fill-button" class="public-style">Sign up now</a>
      <p>If you cannot remember your user name or password, please contact your local public library.</p>

    </div> <!--div class login-footer -->
    <input type="hidden" value="https://localhost/cgi-bin/public.cgi?rm=search_form;submit=Log%20in" name="destination">
    <input type="hidden" name="authen_lid" id="authen_lid" value="">
    <input type="hidden" value="authen_login" name="rm">
  </form>
  </div><!--div class login-->

</div><!--div id main info welcome-->

<script type="text/javascript">
  $('#csstabs').hide();
</script>

<script type="text/javascript">
  document.loginform.authen_username.focus();
</script>

<TMPL_INCLUDE NAME="footer.tmpl">
